import{i as U,r as v,k as L,o as m,c,w as l,a as e,m as N,bl as O,as as j,u as s,s as G,b as f,d as Q,E as P,bu as J,bv as W,e as B,f as M,t as Z,g as z,h as V,j as R,_ as H,cZ as K,p as X,q as h,c_ as ee,c$ as te,v as le,d0 as ne,x as ae}from"./index.fdfc9722.js";import{E as q,a as F,b as Y,c as oe,d as ie,e as se,f as re}from"./el-overlay.0e97f1eb.js";import"./vue-json-viewer.65b4aba9.js";const ue=f("Search"),de=f("Reset"),me={emits:["searchEmit"],setup(A,{emit:$}){const S=U("$axios"),_=v([]),k=v(["Y","N"]),b=v(null),r=v({id:null,name:null,status:null,enabled:null}),p=()=>{b.value.resetFields()};function w(){$("searchEmit",Q.trimObjectValue(r.value))}function u(){S.get("/case-definition/getCaseStepStatusEnums").then(D=>{_.value=D.data})}return L(()=>{u()}),(D,d)=>{const I=P,E=q,C=J,o=W,i=F,n=Y;return m(),c(n,{ref_key:"searchFormRef",ref:b,model:r.value,inline:!0},{default:l(()=>[e(E,{label:"ID",prop:"id"},{default:l(()=>[e(I,{modelValue:r.value.id,"onUpdate:modelValue":d[0]||(d[0]=a=>r.value.id=a),clearable:""},null,8,["modelValue"])]),_:1}),e(E,{label:"NAME",prop:"name"},{default:l(()=>[e(I,{modelValue:r.value.name,"onUpdate:modelValue":d[1]||(d[1]=a=>r.value.name=a),clearable:""},null,8,["modelValue"])]),_:1}),e(E,{label:"STATUS",prop:"status"},{default:l(()=>[e(o,{modelValue:r.value.status,"onUpdate:modelValue":d[2]||(d[2]=a=>r.value.status=a),clearable:"",filterable:""},{default:l(()=>[(m(!0),N(j,null,O(_.value,a=>(m(),c(C,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(E,{label:"ENABLED",prop:"enabled"},{default:l(()=>[e(o,{modelValue:r.value.enabled,"onUpdate:modelValue":d[3]||(d[3]=a=>r.value.enabled=a),clearable:"",filterable:""},{default:l(()=>[(m(!0),N(j,null,O(k.value,a=>(m(),c(C,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(E,null,{default:l(()=>[e(i,{type:"primary",icon:s(G),onClick:d[4]||(d[4]=a=>w())},{default:l(()=>[ue]),_:1},8,["icon"]),e(i,{type:"primary",onClick:d[5]||(d[5]=a=>p())},{default:l(()=>[de]),_:1})]),_:1})]),_:1},8,["model"])}}},pe={class:"dialog-footer"},ce=f("Cancel"),fe=f("Reset"),_e=f("Confirm"),be={props:{data:Object},emits:["closeDialogEmit","refreshEmit"],setup(A,{emit:$}){const S=A,_=B(),{activedProjectId:k}=M(_),b=U("$axios"),r=v("200px");v([]),v([]);const p=Z(S,"data"),w=v(null),u=z({entity:{id:null,name:null,description:null,projectId:null}}),D=z({name:[{required:!0,message:"Please input name",trigger:"blur"},{min:1,max:50,message:"Length should be 1 to 50",trigger:"blur"}],description:[{required:!0}]}),d=()=>{w.value.validate((i,n)=>{i?u.entity.id?b.put("/case-definition",u.entity).then(a=>{C(),o()}):b.post("/case-definition",u.entity).then(a=>{C(),o()}):console.log("error submit!",n)})};function I(){p.value.id?b.get("/case-definition/"+p.value.id).then(i=>{u.entity=i.data,u.entity.projectId=k.value}):u.entity={projectId:k.value}}function E(){w.value.resetFields()}function C(){$("closeDialogEmit")}function o(){$("refreshEmit")}return(i,n)=>{const a=P,g=q,T=Y,t=F,x=oe;return m(),c(x,{modelValue:s(p).visiable,"onUpdate:modelValue":n[6]||(n[6]=y=>s(p).visiable=y),onOpen:I,title:s(p).id?"Edit":"Add"},{footer:l(()=>[V("span",pe,[e(t,{onClick:n[3]||(n[3]=y=>C())},{default:l(()=>[ce]),_:1}),s(p).id?R("",!0):(m(),c(t,{key:0,type:"primary",onClick:n[4]||(n[4]=y=>E())},{default:l(()=>[fe]),_:1})),e(t,{type:"primary",onClick:n[5]||(n[5]=y=>d())},{default:l(()=>[_e]),_:1})])]),default:l(()=>[e(T,{ref_key:"formRef",ref:w,model:s(u).entity,rules:s(D)},{default:l(()=>[s(p).id?(m(),c(g,{key:0,label:"ID",prop:"id","label-width":r.value},{default:l(()=>[e(a,{modelValue:s(u).entity.id,"onUpdate:modelValue":n[0]||(n[0]=y=>s(u).entity.id=y),disabled:"",autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"])):R("",!0),e(g,{label:"NAME",prop:"name","label-width":r.value},{default:l(()=>[e(a,{modelValue:s(u).entity.name,"onUpdate:modelValue":n[1]||(n[1]=y=>s(u).entity.name=y),clearable:"",autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),e(g,{label:"DESCRIPTION",prop:"description","label-width":r.value},{default:l(()=>[e(a,{modelValue:s(u).entity.description,"onUpdate:modelValue":n[2]||(n[2]=y=>s(u).entity.description=y),type:"textarea",clearable:"",autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}};const ye={class:"flex",style:{margin:"10px 10px"}},ve=f("\u6DFB\u52A0"),Ee={style:{display:"flex","align-items":"center"}},Ce={style:{display:"flex","align-items":"center"}},he={setup(A){const $=B(),{activedProjectId:S}=M($),_=U("$axios"),k=K(),b=v({visiable:!1,id:null}),r=v([]);function p(o){o=o||{},o.projectId=S.value,_.get("/case-definition/page",{params:o}).then(i=>{r.value=i.data.records})}function w(o){let i=o.enabled=="Y"?"N":"Y";_.post("/case-definition/changeEnabled/"+o.id+"?enabled="+i).then(n=>{o.enabled=i})}function u(o){k.push({path:"/quietly/step-definition",query:{caseId:o.id,name:o.name}})}function D(o){_.get("/case-definition/runCase/"+o.id).then(i=>{o.status="QUEUING"})}function d(o){b.value.id=o||null,C(!0)}function I(o){_.post("/case-definition/copy/"+o).then(i=>{p()})}function E(o,i){_.delete("/case-definition/"+i.id).then(n=>{r.value.splice(o,1)})}function C(o){b.value.visiable=o}return L(()=>{p()}),(o,i)=>{const n=F,a=ie,g=se,T=re;return m(),N("div",null,[e(me,{onSearchEmit:p}),V("div",ye,[e(n,{type:"primary",icon:s(X),onClick:i[0]||(i[0]=t=>d())},{default:l(()=>[ve]),_:1},8,["icon"])]),e(T,{data:r.value,stripe:"","highlight-current-row":"",height:"calc(100vh - 60px - 40px - 150px)"},{default:l(()=>[e(a,{type:"expand"},{default:l(t=>[V("div",null,[V("p",null,"PROJECT_ID: "+h(t.row.projectId),1),V("p",null,"DESCRIPTION: "+h(t.row.description),1)])]),_:1}),e(a,{prop:"id",label:"ID",width:"180"}),e(a,{prop:"name",label:"NAME"}),e(a,{prop:"status",label:"STATUS",width:"130"},{default:l(t=>[V("div",Ee,[t.row.status=="SUCCESS"?(m(),c(n,{key:0,type:"success",round:"",size:"small"},{default:l(()=>[f(h(t.row.status),1)]),_:2},1024)):t.row.status=="FAILED"?(m(),c(n,{key:1,type:"danger",round:"",size:"small"},{default:l(()=>[f(h(t.row.status),1)]),_:2},1024)):t.row.status=="QUEUING"?(m(),c(n,{key:2,type:"warning",round:"",size:"small"},{default:l(()=>[f(h(t.row.status),1)]),_:2},1024)):t.row.status=="CANCELED"?(m(),c(n,{key:3,type:"warning",round:"",size:"small"},{default:l(()=>[f(h(t.row.status),1)]),_:2},1024)):(m(),c(n,{key:4,type:"primary",round:"",size:"small"},{default:l(()=>[f(h(t.row.status),1)]),_:2},1024))])]),_:1}),e(a,{prop:"enabled",label:"ENABLED",width:"130"},{default:l(t=>[V("div",Ce,[e(g,{title:"Are you sure to enable or disable this one?",onConfirm:x=>w(t.row)},{reference:l(()=>[t.row.enabled=="Y"?(m(),c(n,{key:0,type:"success",round:"",size:"small",title:"switch to enable or disable"},{default:l(()=>[f(h(t.row.enabled),1)]),_:2},1024)):(m(),c(n,{key:1,type:"danger",round:"",size:"small",title:"Set as default"},{default:l(()=>[f(h(t.row.enabled),1)]),_:2},1024))]),_:2},1032,["onConfirm"])])]),_:1}),e(a,{prop:"createTime",label:"CREATE_TIME",width:"180"}),e(a,{prop:"updateTime",label:"UPDATE_TIME",width:"180"}),e(a,{fixed:"right",label:"Operations",width:"240"},{default:l(t=>[e(n,{type:"primary",icon:s(ee),circle:"",size:"small",title:"Step setting",onClick:x=>u(t.row)},null,8,["icon","onClick"]),t.row.enabled=="Y"&&(t.row.status=="CREATED"||t.row.status=="SUCCESS"||t.row.status=="FAILED"||t.row.status=="CANCELED")?(m(),c(g,{key:0,title:"Are you sure to run this test case?",onConfirm:x=>D(t.row)},{reference:l(()=>[e(n,{type:"primary",icon:s(te),circle:"",size:"small",title:"Run Case"},null,8,["icon"])]),_:2},1032,["onConfirm"])):R("",!0),e(n,{type:"primary",icon:s(le),circle:"",size:"small",title:"Edit",onClick:x=>d(t.row.id)},null,8,["icon","onClick"]),e(g,{title:"Are you sure to copy from this?",onConfirm:x=>I(t.row.id)},{reference:l(()=>[e(n,{type:"primary",icon:s(ne),circle:"",size:"small",title:"Copy"},null,8,["icon"])]),_:2},1032,["onConfirm"]),e(g,{title:"Are you sure to delete this?",onConfirm:x=>E(t.$index,t.row)},{reference:l(()=>[e(n,{type:"danger",icon:s(ae),circle:"",size:"small",title:"Delete"},null,8,["icon"])]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),e(be,{data:b.value,onCloseDialogEmit:i[1]||(i[1]=t=>C(!1)),onRefreshEmit:i[2]||(i[2]=t=>p())},null,8,["data"])])}}};var Ve=H(he,[["__scopeId","data-v-691d0f2d"]]);export{Ve as default};
